
name: the-power-workflow-simple
on:
  workflow_dispatch:
  workflow_call:
  repository_dispatch:
    types: [custom_event_type]
jobs:
  the-power-actions-demo:
    runs-on: ubuntu-latest
    steps:

      - name: check-curl-version
        run: |
          curl --version

      - name: test-connectivity-to-api-github-com
        run: |
          curl --verbose -H 'Accept: application/vnd.github+json' -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN}}" https://api.github.com/octocat

      - name: openssl-show-certs
        run: |
          openssl s_client -showcerts -connect github.com:443

      # See this for some comon scenarios https://github.com/actions/checkout?tab=readme-ov-file#scenarios
      - name: checkout-repo-using-actions-checkout
        uses: actions/checkout@v4

      # https://github.com/actions/checkout?tab=readme-ov-file#push-a-commit-using-the-built-in-token
      - name: push-a-commit-to-checked-out-repo-using-built-in-token
        run: |
          date > generated.txt
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "commit generated by github actions in the power"
          git push

      - name: echo-hello-world
        run: |
          echo Hello
          mkdir -p dist/hello
          echo "### Hello World" > dist/hello/hello-world.md

      # https://docs.github.com/en/actions/using-workflows/storing-workflow-data-as-artifacts
      - name: upload-workflow-artifacts
        uses: actions/upload-artifact@v4
        with:
          name: pwr-workflow-simple-artifact-upload-example
          path: |
            dist/**/*.*
          retention-days: 2

      #- name: gh search example with debug mode
      #  env:
      #    GITHUB_TOKEN: ${{ github.token }}
      #  run: |
      #        export GH_DEBUG="api gh pr list"
      #        gh search prs "test"


      - name: gh-repo-list
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: |
              export GH_DEBUG="api gh pr list"
              gh auth status 
              gh repo list

